if (self.CavalryLogger) { CavalryLogger.start_js(["DxcXW"]); }

__d("GraphProductCatalogEventStatsDatePreset",[],(function a(b,c,d,e,f,g){f.exports={TODAY:"today",LAST_28_DAYS:"last_28_days"};}),null);
__d('FantaReducersGetMessages',['AsyncRequest','FantaGetMessageActions','FantaTabActions','FantaTypeAppState','FantaTypeJoinableThread','immutable','ImmutableObject','MercuryConfig','MercuryIDs','MercuryLogMessageType','MercuryMessageStore','MercuryThreadActions','MercuryThreads','XMNCommercePageNullStateCTAController','getPageIDFromThreadID','setImmediate'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryThreadActions').get(),i=c('MercuryThreads').get(),j=c('FantaTabActions').Types,k=c('FantaGetMessageActions').Types,l={},m={};function n(ia,ja){switch(ja.type){case j.OPEN_TAB:case k.CLEAR_PARTICIPANTS:ia=y(ia,ja.tabID);break;}return ia;}function o(ia,ja){switch(ja.type){case j.OPEN_TAB_WITH_INTERSTITIAL_DATA:ia=z(ia,ja.interstitialData);break;}return ia;}function p(ia,ja){switch(ja.type){case j.REPLACE_TAB:ia=y(ia,ja.newTabID);break;}return ia;}function q(ia,ja){switch(ja.type){case k.CLEAR_PREVIEW:var ka=ja.tabID,la=ja.tokens,ma=ia.mercury.tabContents.get(ka);if(!ma)return ia;var na=la.map(function(oa){var pa=oa.info.uid;if(c('MercuryIDs').isValid(pa))return pa;return c('MercuryIDs').getParticipantIDFromUserID(pa);});ma.messageStore&&ma.messageStore.destroy();ia=ia.mergeIn(['mercury','tabContents',ka],{messages:c('immutable').List(),hasFetchedAll:false,messageStore:null,threadPreviewID:null,threadPreviewRecipients:c('immutable').List(na)});i.getThreadMeta(ka,function(oa){c('setImmediate')(function(){return c('FantaGetMessageActions').onGetThreadPreviewResponse(ka,oa);});});break;}return ia;}function r(ia,ja){switch(ja.type){case k.ADD_PARTICIPANTS:ia=u(ia,ja.tabID,ja.previewTabID);break;}return ia;}function s(ia,ja){switch(ja.type){case j.LOAD_FROM_DATA:var ka=ia.tabGroup,la=ja.tabData;if(ka.updatedTime>=la.updatedTime||la.updatedTime===undefined){for(var ma=ia.tabGroup.tabs.keys(),na=Array.isArray(ma),oa=0,ma=na?ma:ma[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var pa;if(na){if(oa>=ma.length)break;pa=ma[oa++];}else{oa=ma.next();if(oa.done)break;pa=oa.value;}var qa=pa,ra=ia.mercury.tabContents.get(qa).messageStore;if(!ra)ia=y(ia,qa);}return ia;}else for(var sa=ia.tabGroup.tabs.keys(),ta=Array.isArray(sa),ua=0,sa=ta?sa:sa[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var va;if(ta){if(ua>=sa.length)break;va=sa[ua++];}else{ua=sa.next();if(ua.done)break;va=ua.value;}var wa=va;ia=y(ia,wa);}break;}return ia;}function t(ia,ja){switch(ja.type){case k.FETCH_MORE_MESSAGES:var ka=ja.threadID,la=ia.mercury.tabContents.get(ka).messageStore;if(la&&!m[ka]){m[ka]=true;la.fetchMoreMessages();}break;}return ia;}function u(ia,ja,ka){i.getThreadMeta(ka,function(la){c('setImmediate')(function(){return c('FantaGetMessageActions').onGetThreadPreviewResponse(ja,la);});});return ia;}function v(ia,ja){switch(ja.type){case k.ON_GET_THREAD_PREVIEW_RESPONSE:var ka=ja.tabID,la=ja.thread;return w(ia,ka,la);}return ia;}function w(ia,ja,ka){var la=ka.thread_id,ma=new (c('MercuryMessageStore'))(la),na=ia.mercury.tabContents.get(ja);if(m[la]||!na)return ia;m[la]=true;na&&na.messageStore&&na.messageStore.destroy();ia=ia.mergeIn(['mercury','tabContents',ja],{thread:ka,messageStore:ma});var oa=setTimeout(function(){m[la]=false;c('FantaGetMessageActions').onShowContextBannerTimer(ja);},6000);ma.subscribe(function(pa){m[la]=false;var qa=pa.messages&&pa.messages[0];if(qa&&qa.log_message_type&&qa.log_message_type===c('MercuryLogMessageType').SERVER_ERROR&&na.messages.size===0){ma.fetchMoreMessages();}else{clearTimeout(oa);c('setImmediate')(function(){c('FantaGetMessageActions').onMessageStoreResponse(pa.messages,ja);});}});return ia;}function x(ia,ja){switch(ja.type){case k.REFRESH_THREAD:return y(ia,ja.threadID);}return ia;}function y(ia,ja){if(!l[ja]){var ka=c('getPageIDFromThreadID')(ja);if(ka&&c('MercuryConfig').FantaTabView){var la=c('XMNCommercePageNullStateCTAController').getURIBuilder();new (c('AsyncRequest'))().setURI(la.getURI()).setMethod('POST').setData({page_id:ka}).setHandler(function(ma){if(ma&&ma.payload){var na=ma.payload,oa=na.title,pa=na.id;c('FantaGetMessageActions').onPageNullResponse(ja,oa,pa);}}).send();}l[ja]=true;i.getThreadMeta(ja,function(ma){c('setImmediate')(function(){return c('FantaGetMessageActions').onGetThreadResponse(ma);});});}return ia;}function z(ia,ja){var ka=new (c('FantaTypeJoinableThread'))(ja),la=ja.threadID,ma=la&&ia.mercury.tabContents.get(la);if(ma)ia=ia.mergeIn(['mercury','tabContents',la],{joinableInterstitialData:ka});return ia;}function aa(ia,ja){switch(ja.type){case k.ON_PAGE_NULL_RESPONSE:var ka=ja.threadID,la=ja.nullPageTitle,ma=ja.nullPageID;if(ia.mercury.tabContents.get(ka))ia=ia.mergeIn(['mercury','tabContents',ka],{nullPageTitle:la,nullPageID:ma});break;}return ia;}function ba(ia,ja){switch(ja.type){case k.ON_GET_THREAD_RESPONSE:var ka=ja.thread;ia=ca(ia,ka);break;}return ia;}function ca(ia,ja){var ka=ja.thread_id;l[ka]=false;var la=ia.mercury.tabContents.get(ka);if(!la)return ia;var ma=la.messageStore;if(!ma){ia=w(ia,ka,ja);}else ia=ia.mergeIn(['mercury','tabContents',ka],{thread:ja});return ia;}function da(ia,ja){switch(ja.type){case k.THREADS_UPDATED:ja.threads.forEach(function(ka){ia=ca(ia,new (c('ImmutableObject'))(ka));});}return ia;}function ea(ia,ja){switch(ja.type){case k.ON_MESSAGE_STORE_RESPONSE:var ka=ja.messages,la=ja.tabID,ma=ia.mercury.tabContents.get(la),na=ma&&ma.messageStore;if(na){var oa=na.hasFetchedAll();ia=ia.mergeIn(['mercury','tabContents',la],{hasFetchedAll:oa,messages:c('immutable').List(ka)});}break;}return ia;}function fa(ia,ja){switch(ja.type){case k.ON_SHOW_CONTEXT_BANNER_TIMER:if(!ia.mercury.tabContents.get(ja.threadID))return ia;ia=ia.mergeIn(['mercury','tabContents',ja.threadID],{showContextBanner:true});break;}return ia;}function ga(ia,ja){switch(ja.type){case j.CLOSE_AND_TAB_NEXT:case j.FOCUS_NEXT_TAB:case j.FOCUS_PREVIOUS_TAB:case j.FOCUS_TAB:case j.SCROLL_BOTTOM_CHANGED:case j.UNMINIMIZE_TAB:case k.ON_GET_THREAD_RESPONSE:case k.ON_MESSAGE_STORE_RESPONSE:case k.REFRESH_THREAD:case k.THREADS_UPDATED:var ka=ia.tabGroup.focusedTabID;if(ka){var la=ia.tabGroup.tabs.get(ka);if(la&&!la.isMinimized){var ma=ia.mercury.tabContents.get(ka);if(ma&&ma.isScrolledToBottom)ha(ka);}}break;}return ia;}function ha(ia){h.markSeen(ia);h.markRead(ia);}f.exports={addParticipants:r,clearPreview:q,fetchMoreMessages:t,loadFromData:s,onFocusChange:ga,onGetThreadPreviewResponse:v,onGetThreadResponse:ba,onMessageStoreResponse:ea,onPageNullResponse:aa,onShowContextBannerTimer:fa,openInterstitialTab:o,openTab:n,refreshThread:x,replaceTab:p,threadsUpdated:da};}),null);
if (self.CavalryLogger) { CavalryLogger.start_js(["F0T5q"]); }

__d('FantaReducersSendMessages',['AsyncRequest','Bootloader','ChatTabViewEvents','EmojiLikeUtils','EmojiState','FantaMessageActions','FantaTabActions','FantaTypeAppState','FantaTypeFileUploader','FantaTypeSharePreview','FantaTypeTabContents','immutable','MercuryAPIArgsSource','mercuryBlockedParticipantsRe','MercuryIDs','MercuryLogMessageType','MercuryMessageActions','MercuryMessageObject','MercuryParticipants','MercurySheetPolicy','MercurySourceType','MercuryThreadActions','MercuryThreadIDMap','MercuryThreadInfo','MercuryThreads','MessageRequestUtils','MessengerAdminGroupUtils','MessengerEmojiUsageUtils','MultiChatController','SiteData','XMessagingSetThreadStateController','getPageIDFromThreadID','setImmediate'],(function a(b,c,d,e,f,g){'use strict';var h=c('mercuryBlockedParticipantsRe').get(),i=c('MercuryMessageActions').get(),j=c('MercuryMessageObject').get(),k=c('MercuryThreadActions').get(),l=c('MercuryThreadIDMap').get(),m=c('MercuryThreads').get(),n=c('FantaMessageActions').Types,o=/^\s*$/,p='/ajax/chat/multichat/name_conversation/dismiss.php';function q(x,y){switch(y.type){case n.UPDATE_GROUP_NAME:var z=y.threadID,aa=y.newName,ba=x.mercury.tabContents.get(z);if(!ba)return x;var ca=ba.thread;if(!ca)return x;var da=ca.name,ea=c('MessengerAdminGroupUtils').isJoinableThread(ca);if((aa||da)&&aa!==da)if(!ea){i.send(j.constructLogMessageObject(c('MercurySourceType').CHAT_WEB,z,c('MercuryLogMessageType').THREAD_NAME,{name:aa}),null,c('MercuryAPIArgsSource').CHAT);}else l.getServerIDFromClientID(z,function(fa){var ga=c('XMessagingSetThreadStateController').getURIBuilder().getURI();new (c('AsyncRequest'))().setURI(ga).setData({thread_id:fa,thread_name:aa}).send();});l.getServerIDFromClientID(z,function(fa){new (c('AsyncRequest'))(p).setData({thread_fbid:fa}).send();});x=x.mergeIn(['mercury','tabContents',z],{openSheet:null});}return x;}function r(x,y){switch(y.type){case n.SEND_GROUP_MESSAGE:var z=y.threadID,aa=x.mercury.tabContents.get(z),ba=aa.thread,ca=aa.typeahead;if(!ca||!ba)return x;var da=ca.getSelectedParticipantIDs();if(ba.is_canonical_user){var ea=ba.participants;c('setImmediate')(function(){return c('MultiChatController').createThreadForTokens(ea.concat(da));});}else{var fa=c('MessengerAdminGroupUtils').shouldInvite(ba);if(fa){da.forEach(function(ha){var ia=c('MercuryIDs').getThreadIDFromParticipantID(ha);if(ia)i.send(j.constructUserGeneratedMessageObject(ba.joinable_mode.link,c('MercurySourceType').CHAT_WEB,ia));});}else i.send(j.constructLogMessageObject(c('MercurySourceType').CHAT_WEB,z,c('MercuryLogMessageType').SUBSCRIBE,{added_participants:da}));}var ga=y.tabID||y.threadID;x=x.mergeIn(['mercury','tabContents',ga],{typeahead:null});}return x;}function s(x,y){var z;switch(y.type){case n.SEND_HOT_LIKE:case n.SEND_MESSAGE:case n.SEND_PHOTO:case n.SEND_STICKER:var aa=y.message,ba=y.threadID,ca=aa?aa.mentions:null;if(aa)aa=aa.message;var da=y.emoji,ea=y.onSendSuccess,fa=y.photoData,ga=y.size,ha=y.source,ia=y.stickerID,ja=x.mercury.tabContents.get(ba),ka=ja.fileUploader,la=ja.sharePreview,ma=ja.signatureID,na=ja.threadPreviewID,oa=ja.threadPreviewRecipients;ba=na||ba;var pa=ja.thread,qa=!!(!aa&&da&&ga),ra=!!(!aa&&ia);if(qa){aa=da;}else if(ra||fa)aa='';var sa=pa&&pa.is_canonical&&!c('MercuryThreadInfo').canReply(pa),ta=!!(la.params&&la.type);if(t(ka,la)){x=x.mergeIn(['mercury','tabContents',ba],{openSheet:c('MercurySheetPolicy').sheets.ChatUploadWarningTabSheet});}else if(sa&&pa){u(pa);}else if(!o.test(aa)||ka.uploadedFiles.size>0||ta||ra||fa){var ua=c('MessengerEmojiUsageUtils').findAllEmojis(aa);if(ua.length>0)c('EmojiState').updateRecentlyUsed(ua);var va=ka.getTypeIDs(c('FantaTypeFileUploader').fileTypes.GENERIC_ATTACHMENT),wa=v(ba,aa,va,la,qa,ka,ga,ha,ra,ia,fa,oa,ca,ma);if(wa&&ea){if(x.mercury.tabContents.get(ba))x=x.mergeIn(['mercury','tabContents',ba],{fileUploader:new (c('FantaTypeFileUploader'))(),sharePreview:new (c('FantaTypeSharePreview'))()});ea();if(na)(function(){var xa=y.threadID;if(!x.mercury.tabContents.get(na))x=x.setIn(['mercury','tabContents',na],new (c('FantaTypeTabContents'))({id:na}));c('setImmediate')(function(){return c('FantaTabActions').replaceTab(xa,na);});})();}}if(!t(ka,la))x=x.mergeIn(['mercury','tabContents',ba],{openSheet:null});return x;}return x;}function t(x,y){return !!(x.uploadingFiles.size>0);}function u(x){var y=x.thread_id,z=c('MercuryIDs').getParticipantIDFromFromThreadID(y);if(z&&x)c('MercuryParticipants').get(z,function(aa){c('Bootloader').loadModules(["MessageBlockedDialog"],function(ba){ba.show(y,x.can_reply,h.isMessageBlocked(x),aa.short_name);},'FantaReducersSendMessages');});}function v(x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka){if(!ea)ea=c('MercurySourceType').CHAT_WEB;var la=j.constructUserGeneratedMessageObject(y,c('MercurySourceType').CHAT_WEB,x);if(z.length>0){la.has_attachment=true;la.raw_attachments=z;}if(ja&&ja.length)la.profile_ranges=la.profile_xmd=ja;if(fa){la.has_attachment=true;la.sticker_id=ga;}if(!ba&&aa.params&&aa.type){var ma={share_params:aa.params.get('data'),share_type:aa.type};if(ma){la.has_attachment=true;la.shareable_attachment=ma;}}la.signatureID=ka;la.ui_push_phase=c('SiteData').push_phase;if(ha){la.content_attachment=null;i.addAttachmentPlaceholder(la,ha.upload_id,ha);}else if(!ba){la=w(la,ca);if(m.isEmptyLocalThread(x)){if(ia)k.addParticipants(x,ia.toArray());la.offline_threading_id=c('MercuryIDs').tokenize(x).value;var na=m.getThreadMetaNow(x);if(na)la.specific_to_list=Array.from(na.participants);}i.send(la,function(oa){var pa=m.getThreadMetaNow(oa);if(pa&&c('MessageRequestUtils').isMessageRequest(pa))k.movePendingToInbox(oa);if(pa&&pa.other_user_fbid&&c('getPageIDFromThreadID')(pa.other_user_fbid))c('ChatTabViewEvents').inform('chat-send-to-page',{pageID:pa.other_user_fbid});});}else if(da&&ea){la.has_attachment=false;i.send(function(){c('EmojiLikeUtils').setEmojiSize(la,da||'');return c('EmojiLikeUtils').setEmojiSource(la,ea||'');}());}k.markRead(x);k.markSeen(x);return true;}function w(x,y){var z=y.getTypeIDs(c('FantaTypeFileUploader').fileTypes.IMAGE);if(z.length>0){x.image_ids=z;x.has_attachment=true;}var aa=y.getTypeIDs(c('FantaTypeFileUploader').fileTypes.ANIMATED_IMAGE);if(aa.length>0){x.gif_ids=aa;x.has_attachment=true;}var ba=y.getTypeIDs(c('FantaTypeFileUploader').fileTypes.VIDEO);if(ba.length>0){x.video_ids=ba;x.has_attachment=true;}var ca=y.getTypeIDs(c('FantaTypeFileUploader').fileTypes.AUDIO);if(ca.length>0){x.audio_ids=ca;x.has_attachment=true;}var da=y.getTypeIDs(c('FantaTypeFileUploader').fileTypes.FILE);if(da.length>0){x.file_ids=da;x.has_attachment=true;}return x;}f.exports={sendGroupMessage:r,sendMessage:s,updateGroupName:q};}),null);
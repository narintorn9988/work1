if (self.CavalryLogger) { CavalryLogger.start_js(["JYShF"]); }

__d("XAssociateGroupThreadController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/groups\/messenger\/associate_group_thread\/",{});}),null);
__d("XGroupSideConversationCreateController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/groups\/side_conversation\/",{post_id:{type:"Int"}});}),null);
__d('MultiChatController',['AsyncRequest','AsyncSignal','ChatOpenTabEventLogger','FantaTabActions','Form','MercuryDispatcher','MercuryIDs','MercuryLocalIDs','MercuryThreadIDMap','MercuryViewer','MercuryServerDispatcher','MercuryThreads','XAssociateGroupThreadController','XGroupSideConversationCreateController'],(function a(b,c,d,e,f,g){var h=c('MercuryDispatcher').get(),i=c('MercuryThreadIDMap').get(),j=c('MercuryThreads').get(),k=c('XGroupSideConversationCreateController').getURIBuilder().getURI().toString(),l=c('XAssociateGroupThreadController').getURIBuilder().getURI().toString();function m(){}Object.assign(m,{subscribe:function o(p,q){p.subscribe('confirm',function(){this.createGroupThreadFromChooserDialog(p,q);}.bind(this));},subscribeFromPost:function o(p,q){p.subscribe('confirm',function(){this.createGroupPostThreadFromChooserDialog(p,q);}.bind(this));},createGroupPostThreadFromChooserDialog:function o(p,q){var r=c('Form').serialize(p.getRoot()),s=JSON.parse(r.profileChooserItems),t=Object.keys(s).filter(function(u){return !!s[u];});m.createThreadForFBIDs(t);new (c('AsyncRequest'))().setURI(k).setData({post_id:q}).send();p.hide();},createGroupThreadFromChooserDialog:function o(p,q){var r=c('Form').serialize(p.getRoot()),s=JSON.parse(r.profileChooserItems),t=[];for(var u in s)if(s[u])t.push(u);var v=m.createThreadForFBIDs(t),w=h.subscribe('update-thread-ids',function(x,y){for(var z in y)if(y[z]==v){var aa=j.getThreadMetaNow(v),ba=i.getServerIDFromClientIDNow(v);if(aa&&!aa.is_canonical&&ba)c('MercuryServerDispatcher').trySend(l,{group_id:q,thread_id:ba});new (c('AsyncSignal'))('/ajax/groups/chat/log',{group_id:q,message_id:z}).send();h.unsubscribe(w);break;}});p.hide();},createThreadForTokens:function o(p){var q=c('MercuryViewer').getID();if(!p.length)return;p=p.filter(function(s){return s!==q;});var r;if(p.length===0){return;}else if(p.length===1){r=c('MercuryIDs').getThreadIDFromParticipantID(p[0]);c('FantaTabActions').openTab(r);c('ChatOpenTabEventLogger').log('ChatTabView',r);}else{r=c('MercuryLocalIDs').generateThreadID();p.unshift(q);j.createNewLocalThread(r,p);c('FantaTabActions').openTab(r);c('ChatOpenTabEventLogger').log('MultiChatController',r);}return r;},createThreadForFBIDs:function o(p){var q=[];for(var r=0;r<p.length;r++)q.push('fbid:'+p[r]);return m.createThreadForTokens(q);}});var n={};n[l]={mode:c('MercuryServerDispatcher').IMMEDIATE};c('MercuryServerDispatcher').registerEndpoints(n);f.exports=m;}),null);